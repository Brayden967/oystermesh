<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Oyster Mesh</title>
    <script src="oystermesh.js"></script>
    <script src="peer.min.js"></script>
</head>
<body>
Oyster Mesh Sandbox
</body>
<div id="control_buttons" style="display:none;">
    <input type="button" value="START" onclick="start()" />
    <input type="button" value="TEST" onclick="test()" />
</div>
<script type="text/javascript">
    function getQueryVariable(variable) {
        var query = window.location.search.substring(1);
        var vars = query.split("&");
        for (var i=0;i<vars.length;i++) {
            var pair = vars[i].split("=");
            if(pair[0] == variable){return pair[1];}
        }
        return(false);
    }

    window.conn = null;
    var peer = new Peer(getQueryVariable("self"), {key: 'lwjd5qra8257b9'});
    peer.on('open', function(id) {
        console.log('My peer ID is: ' + id);
    });

    var other = getQueryVariable("other");
    console.log(other);

    if (other!==false) {
        document.getElementById('control_buttons').style.display = "block";
        /*
        window.conn = peer.connect(other);
        window.conn.on('open', function() {
            // Send messages
            window.conn.send('Hello!');
            console.log("BOB"+window.conn.id);
            console.log("message sent");
        });
        */
    }
    if (1) {
        peer.on('connection', function(conn) {
            // Receive messages
            conn.on('data', function (data) {
                console.log('Received', data);
                console.log(conn.peer);
            });
        });
    }
    function start() {
        window.conn = peer.connect(other);
        window.conn.on('open', function() {
        });
    }
    function test() {
        console.log("test active");
        window.conn.send('2Hello!');
        console.log("2BOB"+window.conn.id);
        console.log("2message sent");
    }
    //*/
</script>
</html>
