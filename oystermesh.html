<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Oyster Mesh</title>
    <script src="oystermesh.js"></script>
    <script src="peer.min.js"></script>
</head>
<body>
Oyster Mesh<br>
ID: <span id="oy_field_id"></span>
<br><br>
<input id="oy_input_node" type="text" style="width:100px;" />
<input type="button" value="NODE CONNECT" onclick="oy_button()" />
<br><br>
<input id="oy_push_handle" type="text" style="width:100px;" />
<input id="oy_push_data" type="text" style="width:100px;" />
<input id="oy_button_push" type="button" value="DATA PUSH" onclick="oy_button2()" />
<input id="oy_button_push_cancel" type="button" disabled="disabled" value="CANCEL" onclick="oy_button3()" />
<br><br>
<input id="oy_pull_handle" type="text" style="width:100px;" />
<input id="oy_pull_data" type="text" style="width:100px;" />
<input id="oy_button_pull" type="button" value="DATA PULL" onclick="oy_button4()" />
<input id="oy_button_pull_cancel" type="button" disabled="disabled" value="CANCEL" onclick="oy_button5()" />
<br><br>
<input type="button" value="RESET" onclick="localStorage.clear()" />
<div id="oy_peer_list">
    BLANK
</div>
<script type="text/javascript">
    //oy_peers_clear();
    //console.log(oy_peer_add("bob"));
    //console.log(oy_peers_get());

    //localStorage.clear();

    oy_init();
    document.getElementById("oy_field_id").innerHTML = window.OY_MAIN['oy_self_id'];
    function oy_button() {
        oy_node_initiate(document.getElementById('oy_input_node').value);
    }
    function oy_button2() {
        document.getElementById("oy_push_data").disabled = true;
        document.getElementById("oy_push_handle").disabled = true;
        document.getElementById("oy_button_push").disabled = true;
        document.getElementById("oy_button_push_cancel").disabled = false;
        if (document.getElementById('oy_push_handle').value.indexOf("@")===-1) {
            document.getElementById('oy_push_handle').value += "@"+oy_data_nonce(document.getElementById('oy_push_data').value.length);
        }
        oy_data_push(["OY_LOGIC_SPREAD"], document.getElementById('oy_push_handle').value.split("@")[0], document.getElementById('oy_push_data').value);
    }
    function oy_button3() {
        document.getElementById("oy_push_data").disabled = false;
        document.getElementById("oy_push_handle").disabled = false;
        document.getElementById("oy_button_push").disabled = false;
        document.getElementById("oy_button_push_cancel").disabled = true;
        console.log(window.OY_DATA[document.getElementById('oy_push_handle').value.split("@")[0]]);
        window.OY_DATA[document.getElementById('oy_push_handle').value.split("@")[0]] = false;
    }
    function oy_button4() {
        document.getElementById("oy_pull_data").disabled = true;
        document.getElementById("oy_pull_handle").disabled = true;
        document.getElementById("oy_button_pull").disabled = true;
        document.getElementById("oy_button_pull_cancel").disabled = false;
        oy_data_pull(["OY_LOGIC_SPREAD"], document.getElementById('oy_input_handle').value, document.getElementById('oy_input_data').value);
    }
    function oy_button5() {
        document.getElementById("oy_pull_data").disabled = false;
        document.getElementById("oy_pull_handle").disabled = false;
        document.getElementById("oy_button_pull").disabled = false;
        document.getElementById("oy_button_pull_cancel").disabled = true;
    }
    function oy_maintain() {
        let oy_peer_build = "";
        for (let i in window.OY_PEERS) {
            oy_peer_build += i+"<br>";
        }
        document.getElementById("oy_peer_list").innerHTML = oy_peer_build;
        setTimeout("oy_maintain()", 200);
    }
    oy_maintain();
</script>
</body>
</html>